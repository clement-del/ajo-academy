[home](README.md)

<p align="center">
<img width="1280" alt="image" src="https://github.com/user-attachments/assets/1bf8639a-755b-4aa3-88e0-5126a064b41b" />
</p>

Personalize the Conversion Path and Abandoned Cart Follow-Up
============================================================================

We will now personalize the conversion path using AEP's customer experience engine, Journey Optimizer. 

The objective of our customer journey is twofold:

- Retarget Luma website users who have abandoned the purchase process.
- Send a confirmation message to users who have confirmed their orders.

---

# The Journey Optimizer User Interface

Click on the 9 dots in the top right corner of the interface and on the _Journey Optimizer_ link in the drop-down menu.

<img width="604" alt="image" src="https://github.com/user-attachments/assets/b9155589-15f1-4c4f-aed8-ff08f203c26b" />


You are now in AJO. You are going to build your own Purchase Journey. In the _Browse_ tab, click _Create Journey_

<img width="630" alt="image" src="https://github.com/user-attachments/assets/34ce1ee8-b83a-48cc-97ca-c8648dea12e8" />

- Name your journey _Purchase Journey_, please prefix it with the email address you used when creating your account on Luma website, like: _delaland+p1@adobetest.com - Purchase Journey_
- Click Save


---

# The Journey Canvas
The customer journey canvas is the central point for creating a real-time customer experience. The interface allows you to drag and drop three types of activities:
- Events: These are user actions (or actions generated by a third-party system) that arrive in real time in AEP, that you are willing to listen and react.
- Orchestration: Useful to apply filtering condition on the incoming population and to delay steps in a journey. The Read Audience activity lets you target an audience previously built, such as the _Luma - Blue Luma+ Members_ audience your profile automatically qualified previously. 
- Actions: These are the different activities you can leverage to react and send communication to your customer. AJO comes with native activities to send personalized communications through inbound channels (website, in-app, kiosk, connected tvs) as well as outbound channels (email, sms, push notif). Of course you can build your own action if you have specific needs, like interacting with a proprietary channel (like exotic channels, ATM, call center, CRM systems etc)

The journey you are going to build is composed of multiplate activities. we're going to 
- Listen to Checkout Event from the Luma website
- Apply filter on the inbound population
- Listen to Purchase Event from Luma website
- Get Information from Luma Loyalty System to retrive promo code and offers.
- Send an order confirmation email

![image](https://github.com/user-attachments/assets/5fde1f17-8788-4d61-89dd-6345cb9eaa6d)


Pretty straightforward isn't it ? Now let's spice the journey a bit with more intelligence. We'd also like to retarget profiles who started the checkout process, but did not complete. Here what we're going to do: 
- Add a transition in case the Purchase Event did not arrive after a certain time
- Verify the customer preferred channel of communication
- Send a Push Notification through the mobile app to invite profile to resume his purchase or
- Send an Email with the content of the pending cart


![image](https://github.com/user-attachments/assets/35ae7e6f-f3e9-421e-8896-36f1ccd7bf07)


---
# Build the Order Confirmation Branch

The first event we are going to use to start the journey is triggered by the checkout page from the website. The event has been configured by the martech team and basically carries the information from the website datalayer. You'll find in this event a json object representing the cart content as well as the profile details. 
- Select the  _LumaCheckoutEvent_Email_ from the _EVENTS_ menu and drag and drop it to the canva

- Select the _Condition_ activity from the _ORCHESTRATION_ menu and drag and drop it to the canva 
  - Label the activity _Filter Profile_ This is required in order to let in your journey only your profile and leave your classmates profiles to their respective journeys. This activity would not be necessary outside the context of the lab.
  - Select the  attribute __aeppartner1.identification.core.email_ from the LumaChekcoutEvent_Email
  - Make sure the email address you put in corresponds to the one set in the login form of the Luma website when you registered in the previous exercice.
    ![image](https://github.com/user-attachments/assets/45dcf93a-eafe-4e37-a66c-11d535b70274)
- Select the  _LumaPurchaseEvent_Email_ from the _EVENTS_ menu and drag and drop it to the canva
- Select the _LoyaltyService_ from the _ACTIONS_ menu and drag and drop it to the canva
  - Now let's configure the request parameters of our custom action that will retrieve a promo code based on the purchase value. We have to send to the LoyaltyService API the customerId as well as the order value: 
    - In the _customerId_ input, select the attribute _@event{LumaPurchaseEvent_Email._aeppartner1.identification.core.email}_
    - In the _priceTotal_ input, select the attribute _@event{LumaPurchaseEvent_Email.productListItems.at(0).priceTotal}_
    - Click the _Save_ button
- Select the _Email_ activity from the _ACTIONS_ menu and drag and drop it to the canva
    - Label the email _Order Confirmation Email_. It gives a name to your email delivery and will help you track its performance in the report
    - Under Email Configuration, select the _EmailMarketing_ value. It applies deliverability settings and email metadata (from, headers fields, tracking parameters) to the delivery
    - Make sure Tracking (clicks on email, email opens) are enabled

## Build the Order Confirmation Email 
- Click _Edit Content_ button. It opens the email editor where you can customize the content of the email
- Let's configure the subject line with our profile first name as personalisation token. Click the ![image](https://github.com/user-attachments/assets/3ae69ec7-673b-4af9-b131-8dd1ef049189) icon and fetch the first name attribute of the real time customer profile (available at Profile attribute > Person > Full name), then click the ![image](https://github.com/user-attachments/assets/9364edca-5e09-4d3b-a7d9-cadf12213a88) icon to add it to the subject line, and append '_, your order confirmation_'
- Click _Save_

- Let's author the email body now. In the body section, click _Edit email body_
- There are multiple options to build your communications. Like using a template or create your own content. Le's select _Build your own_
- Let's start with the header
  - In Components > Structures > Select a 1:1 column

  - In Asset Selector > Collection > Select the Luma Collection, and drag'n'drop  the Luma logo in the first structure, then you can resize to 60% and center-align the picture using the _Styles_ menu from the right hand rail
  - Now, let's add a fragment, select the _Order Confirmation Text_
  - In Components > Contents > add a Container and add a Text content, and type _Here are the details of your order_ and click _Edit Personalization_ to get the content of the order.
    Under _Helper functions_, select _each_, then click _+_ sign and under Contextual attributes, look for _productListItems_.
    In the _each_ block, select Fragments  then click on the 3 dots besides _Order Content_ and select _Paste Fragment_
![image](https://github.com/user-attachments/assets/74be954b-c978-4e4e-aacd-d1331cf6e0dd)
  - Click _Save_

Let's add conditional content in the email. We want to invite customer who haven't the Luma Mobile App installed to do so. For the other, we'd like to promote the Luma+ Loyalty Program. First, let's drag and drop a new container
- select the _Luma Loyalty +_ banner from the Assets selector
- Add conditional content by clicking the ![image](https://github.com/user-attachments/assets/5de06ca6-7568-4e04-b4e9-66c4c0d0bdf5) icon and create another variant, name it: _Not Mobile App Users_ and edit a new condition by drag and dropping the audience _Luma Mobile App Users_, and switch the operator in the drop down to _does not include the audience_, then validate by clicking _Select_
![image](https://github.com/user-attachments/assets/3121d8ef-e349-4597-8eb9-f82ddcc44044)
- Update the image asset and select the _luma mobile app_ banner fromt the Asset selector.


**Add the Promo Code**
- We'd like to spice the email content with a Promo Code that we retrieved on the fly from our couponing system. Those details are part of the content of our journey and we can use them to personnalize further the email content.
- Add a new container _Text_ container in the email
- Click Edit Personalization, remove _Please type your text here._ and type instead _We selected this offer for you_, then under  _Contextual Attributes > Journey Orchestration > Actions > Loyalty Service_, select the _LoyaltyOffer_ attribute, then click _Save_.

- ![image](https://github.com/user-attachments/assets/7e1f26a2-c473-4371-bc47-1a0c9dfcd35a)


- Now, let's add the _Luma - Footer Fragment_ to complete our email
- Congratulation you completed your first email with AJO, it should look like this :
![image](https://github.com/user-attachments/assets/170efcef-004e-4d8f-913e-22fc1d561efd)




---
# Build the Abandoned Cart  Branch



---

## The Abandoned Cart Email

To re-engage our customers who haven't completed the purchasing process, we'll use an action activity. This will allow us to instantly communicate with Adobe Campaign's transactional component to send a message inviting the customer to return to the website.

- Select the _CampaignCartAbandonment_ activity from the Activities menu
- Drag and drop it into the bottom path of the customer journey so that it is linked to the previous event
- In the _Email_ field, click the pencil icon and select _LumaCheckoutEvent -> demosystem4 -> identification -> core -> Email_ and click _OK_
- In the _Name_ field, click the pencil icon and type _first_ to filter the attributes and select the first attribute _firstName_ and click _OK_
- Link the _LumaPurchaseEvent1_ event to the activity transition _CampaignCartAbandonment_

![cartAbandonment2](https://user-images.githubusercontent.com/40355195/223142393-a7c526f5-41dd-4c1d-80b5-8b3988bd67e2.gif)

---

## The Order Confirmation Email

To re-engage our customers who haven't completed the purchasing process, we'll use an action activity. This will allow us to instantly communicate with Adobe Campaign's transactional component to send a message inviting the customer to return to the website.

- Select the _CampaignCartAbandonment_ activity from the Activities menu
- Drag and drop it into the bottom path of the customer journey so that it is linked to the previous event
- In the _Email_ field, click the pencil icon and select _LumaCheckoutEvent -> demosystem4 -> identification -> core -> Email_ and click _OK_
- In the _Name_ field, click the pencil icon and type _first_ to filter the attributes and select the first attribute _firstName_ and click _OK_
- Link the _LumaPurchaseEvent1_ event to the activity transition _CampaignCartAbandonment_

![cartAbandonment2](https://user-images.githubusercontent.com/40355195/223142393-a7c526f5-41dd-4c1d-80b5-8b3988bd67e2.gif)

---

## Test your journey
Now it's time to test your journey!
- In the canvas, activate _test mode_, return to the website, add an item to your cart, and click the _Shopping Cart_ button in the top right corner of the interface. Click the _Checkout_ button, then _Proceed_.
- Return to Profile Orchestration and view your user's progress through the customer journey. After a given period of inactivity, the user is considered to have abandoned the purchase process, and the email you previously configured is sent with a link to revalidate their cart.
- Go to your email client and click on the link in the new email received. This will take you back to the cart, where you can complete your purchase online.

<div align="center">
<br />
<img src="https://sv-ac-demos.com/shared/delaland/dsn/testConversionBootcamp.gif" />
<br />
<br />
</div>


---

## Journey Reporting

---

## Package your journey and share it


---

Congratulations! You have completed the second chapter of the lab 👍 ✨ 🎉, go to the [next step](campaign.md) or return to the [home](README.md)
